<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Deploy a Sharded Cluster &mdash; MongoDB Manual 2.4.1</title>

    <link rel="shortcut icon" href="http://media.mongodb.org/favicon.ico" />
    <meta name="robots" content="index" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="release" content=""/>
    <link rel="canonical" href="http://docs.mongodb.org/manual/tutorial/deploy-shard-cluster" />

    
    
    <link rel="stylesheet" href="../../_static/mongodb-docs.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  false,
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="http://docs.mongodb.org/osd.xml" title="MongoDB Help"/>
<link rel="author" title="About these documents" href="../../about/" />
<link rel="top" title="MongoDB Manual" href="../../" />
<link rel="up" title="Sharding" href="../../sharding/" />
<link rel="next" title="Add Shards to a Cluster" href="../add-shards-to-shard-cluster/" />
<link rel="prev" title="Sharded Cluster Internals and Behaviors" href="../../core/sharded-cluster-internals/" />
<script>
  (function() {
    var cx = '017213726194841070573:WMX6838984';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
  </head>
  <body>
<div id="top-right">
        <div class="user-right">
                <ul id="header-menu-bar" class="ajs-menu-bar">
                <li class="normal"><a target="_blank" href="http://groups.google.com/group/mongodb-user">Forums</a></li>
                <li class="normal"><a target="_blank" href="http://blog.mongodb.org/">Blog</a></li>
                <li class="normal"><a href="http://www.mongodb.org/downloads">Download</a></li>
                <li class="normal"><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></li>
                <li class="normal"><a href="http://www.10gen.com/events">Events</a></li>
                <li class="normal last"><a class="last" href="http://docs.mongodb.org/manual/meta/translation">Translations</a></li>
                </ul>
        </div>
</div>
<div id="header-db" class="spread">
        <div class="split">
                <div id="logo">
                        <div><a href="../../"><img class="logo" src="http://media.mongodb.org/logo-mongodb.png" alt="MongoDB Logo"/></a></div>
                </div>
        </div>

<div class="search-db"><gcse:searchbox></gcse:searchbox></div>
<div id="etp">
<ul>
<li><a href="https://github.com/mongodb/docs/blob/master/source/tutorial/deploy-shard-cluster.txt" target="_blank" title="Edit tutorial/deploy-shard-cluster.txt on github">Edit this Page</a></li>
<li><a href="http://github.com/mongodb/docs" target="_blank" title="Fork the documentation on GitHub and contribute.">GitHub</a></li>
<li><a id="jirafeedback" href="https://jira.mongodb.org/secure/CreateIssueDetails!init.jspa?pid=10380&issuetype=4&priority=4&summary=Comment+on%3a+%22tutorial/deploy-shard-cluster%2Etxt%22" target="_blank" title="Report a problem with tutorial/deploy-shard-cluster.txt on Jira">Report a problem</a></li>
</ul>
</div>
</div>  
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            <div id="cse-results"><gcse:searchresults linkTarget="_top"></gcse:searchresults></div>
            
  <div class="section" id="deploy-a-sharded-cluster">
<span id="sharding-procedure-setup"></span><h1>Deploy a Sharded Cluster<a class="headerlink" href="#deploy-a-sharded-cluster" title="Permalink to this headline">¶</a></h1>
<p>The topics on this page present an ordered sequence of the tasks
required to set up a <a class="reference internal" href="../../reference/glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>. Before deploying a
sharded cluster for the first time, consider the
<a class="reference internal" href="../../core/sharded-clusters/"><em>Sharded Cluster Overview</em></a> and
<a class="reference internal" href="../../administration/sharded-cluster-architectures/"><em>Sharded Cluster Architectures</em></a> documents.</p>
<p>To set up a sharded cluster, complete the following sequence of tasks
in the order defined below:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#sharding-setup-start-cfgsrvr"><em>Start the Config Server Database Instances</em></a></li>
<li><a class="reference internal" href="#sharding-setup-start-mongos"><em>Start the mongos Instances</em></a></li>
<li><a class="reference internal" href="#sharding-setup-add-shards"><em>Add Shards to the Cluster</em></a></li>
<li><a class="reference internal" href="#sharding-setup-enable-sharding"><em>Enable Sharding for a Database</em></a></li>
<li><a class="reference internal" href="#sharding-setup-shard-collection"><em>Enable Sharding for a Collection</em></a></li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Sharding and &#8220;localhost&#8221; Addresses</p>
<p class="last">If you use either &#8220;localhost&#8221; or <tt class="docutils literal"><span class="pre">127.0.0.1</span></tt> as the hostname
portion of any host identifier, for example as the <tt class="docutils literal"><span class="pre">host</span></tt> argument
to <a class="reference internal" href="../../reference/command/addShard/#dbcmd.addShard" title="dbcmd.addShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">addShard</span></tt></a> or the value to the
<a class="reference internal" href="../../reference/mongos/#cmdoption-mongos--configdb"><em class="xref std std-option">--configdb</em></a>
run time option, then you must use &#8220;localhost&#8221; or
<tt class="docutils literal"><span class="pre">127.0.0.1</span></tt> for <em>all</em> host settings for any MongoDB instances in
the cluster. If you mix localhost addresses and remote host address,
MongoDB will error.</p>
</div>
<div class="section" id="start-the-config-server-database-instances">
<span id="sharding-setup-start-cfgsrvr"></span><h2>Start the Config Server Database Instances<a class="headerlink" href="#start-the-config-server-database-instances" title="Permalink to this headline">¶</a></h2>
<p>The config server processes are <a class="reference internal" href="../../reference/mongod/#bin.mongod" title="bin.mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instances that store
the cluster&#8217;s metadata. You designate a <a class="reference internal" href="../../reference/mongod/#bin.mongod" title="bin.mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> as a config
server using the <a class="reference internal" href="../../reference/mongod/#cmdoption-mongod--configsvr"><em class="xref std std-option">--configsvr</em></a> option. Each
config server stores a complete copy of the cluster&#8217;s metadata.</p>
<p>In production deployments, you must deploy exactly three config server
instances, each running on different servers to assure good uptime and
data safety. In test environments, you can run all three instances on a
single server.</p>
<p>Config server instances receive relatively little traffic and demand
only a small portion of system resources. Therefore, you can run an
instance on a system that runs other cluster components.</p>
<ol class="arabic">
<li><p class="first">Create data directories for each of the three config server
instances. By default, a config server stores its data files in the
<cite>/data/configdb</cite> directory. You can choose a different location. To
create a data directory, issue a command similar to the following:</p>
<div class="highlight-sh"><div class="highlight"><pre>mkdir /data/configdb
</pre></div>
</div>
</li>
<li><p class="first">Start the three config server instances. Start each by issuing a
command using the following syntax:</p>
<div class="highlight-sh"><div class="highlight"><pre>mongod --configsvr --dbpath &lt;path&gt; --port &lt;port&gt;
</pre></div>
</div>
<p>The default port for config servers is <tt class="docutils literal"><span class="pre">27019</span></tt>. You can specify a
different port. The following example starts a config server using
the default port and default data directory:</p>
<div class="highlight-sh"><div class="highlight"><pre>mongod --configsvr --dbpath /data/configdb --port 27019
</pre></div>
</div>
<p>For additional command options, see <a class="reference internal" href="../../reference/mongod/"><em>mongod</em></a> or
<a class="reference internal" href="../../reference/configuration-options/"><em>Configuration File Options</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All config servers must be running and available when you first initiate
a <a class="reference internal" href="../../reference/glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="start-the-mongos-instances">
<span id="sharding-setup-start-mongos"></span><h2>Start the <tt class="docutils literal"><span class="pre">mongos</span></tt> Instances<a class="headerlink" href="#start-the-mongos-instances" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../../reference/mongos/#bin.mongos" title="bin.mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances are lightweight and do not require data
directories. You can run a <a class="reference internal" href="../../reference/mongos/#bin.mongos" title="bin.mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance on a system that
runs other cluster components, such as on an application server or a
server running a <a class="reference internal" href="../../reference/mongod/#bin.mongod" title="bin.mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> process. By default, a
<a class="reference internal" href="../../reference/mongos/#bin.mongos" title="bin.mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance runs on port <tt class="docutils literal"><span class="pre">27017</span></tt>.</p>
<p>When you start the <a class="reference internal" href="../../reference/mongos/#bin.mongos" title="bin.mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance, specify the hostnames of
the three config servers, either in the configuration file or as command
line parameters. For operational flexibility, use DNS names for the
config servers rather than explicit IP addresses. If you&#8217;re not using
resolvable hostname, you cannot change the config server names or IP
addresses without a restarting <em>every</em> <a class="reference internal" href="../../reference/mongos/#bin.mongos" title="bin.mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> and
<a class="reference internal" href="../../reference/mongod/#bin.mongod" title="bin.mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> instance.</p>
<p>To start a <a class="reference internal" href="../../reference/mongos/#bin.mongos" title="bin.mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance, issue a command using the following syntax:</p>
<div class="highlight-sh"><div class="highlight"><pre>mongos --configdb &lt;config server hostnames&gt;
</pre></div>
</div>
<p>For example, to start a <a class="reference internal" href="../../reference/mongos/#bin.mongos" title="bin.mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> that connects to config server
instance running on the following hosts and on the default ports:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cfg0.example.net</span></tt></li>
<li><tt class="docutils literal"><span class="pre">cfg1.example.net</span></tt></li>
<li><tt class="docutils literal"><span class="pre">cfg2.example.net</span></tt></li>
</ul>
<p>You would issue the following command:</p>
<div class="highlight-sh"><div class="highlight"><pre>mongos --configdb cfg0.example.net:27019,cfg1.example.net:27019,cfg2.example.net:27019
</pre></div>
</div>
</div>
<div class="section" id="add-shards-to-the-cluster">
<span id="sharding-setup-add-shards"></span><h2>Add Shards to the Cluster<a class="headerlink" href="#add-shards-to-the-cluster" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="../../reference/glossary/#term-shard"><em class="xref std std-term">shard</em></a> can be a standalone <a class="reference internal" href="../../reference/mongod/#bin.mongod" title="bin.mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> or or a
<a class="reference internal" href="../../reference/glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>. In a production environment, each shard
should be a replica set.</p>
<ol class="arabic">
<li><p class="first">From a <a class="reference internal" href="../../reference/mongo/#bin.mongo" title="bin.mongo"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt></a> shell, connect to the <a class="reference internal" href="../../reference/mongos/#bin.mongos" title="bin.mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>
instance. Issue a command using the following syntax:</p>
<div class="highlight-sh"><div class="highlight"><pre>mongo --host &lt;hostname of machine running mongos&gt; --port &lt;port mongos listens on&gt;
</pre></div>
</div>
<p>For example, if a <a class="reference internal" href="../../reference/mongos/#bin.mongos" title="bin.mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> is accessible at
<tt class="docutils literal"><span class="pre">mongos0.example.net</span></tt> on port <tt class="docutils literal"><span class="pre">27017</span></tt>, issue the following
command:</p>
<div class="highlight-sh"><div class="highlight"><pre>mongo --host mongos0.example.net --port 27017
</pre></div>
</div>
</li>
<li><p class="first">Add each shard to the cluster using the <a class="reference internal" href="../../reference/method/sh.addShard/#sh.addShard" title="sh.addShard"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addShard()</span></tt></a>
method, as shown in the examples below. Issue <a class="reference internal" href="../../reference/method/sh.addShard/#sh.addShard" title="sh.addShard"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addShard()</span></tt></a>
separately for each shard. If the shard is a replica set, specify the
name of the replica set and specify a member of the set. In
production deployments, all shards should be replica sets.</p>
<div class="admonition-optional admonition">
<p class="first admonition-title">Optional</p>
<p class="last">You can instead use the <a class="reference internal" href="../../reference/command/addShard/#dbcmd.addShard" title="dbcmd.addShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">addShard</span></tt></a> database
command, which lets you specify a name and maximum size for the
shard. If you do not specify these, MongoDB automatically assigns
a name and maximum size. To use the database command, see
<a class="reference internal" href="../../reference/command/addShard/#dbcmd.addShard" title="dbcmd.addShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">addShard</span></tt></a>.</p>
</div>
<p>The following are examples of adding a shard with
<a class="reference internal" href="../../reference/method/sh.addShard/#sh.addShard" title="sh.addShard"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addShard()</span></tt></a>:</p>
<ul>
<li><p class="first">To add a shard for a replica set named <tt class="docutils literal"><span class="pre">rs1</span></tt> with a member
running on port <tt class="docutils literal"><span class="pre">27017</span></tt> on <tt class="docutils literal"><span class="pre">mongodb0.example.net</span></tt>, issue the
following command:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">sh</span><span class="p">.</span><span class="nx">addShard</span><span class="p">(</span> <span class="s2">&quot;rs1/mongodb0.example.net:27017&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.0.3.</span></p>
<p>For MongoDB versions prior to 2.0.3, you must specify all members of the replica set. For
example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">sh</span><span class="p">.</span><span class="nx">addShard</span><span class="p">(</span> <span class="s2">&quot;rs1/mongodb0.example.net:27017,mongodb1.example.net:27017,mongodb2.example.net:27017&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">To add a shard for a standalone <a class="reference internal" href="../../reference/mongod/#bin.mongod" title="bin.mongod"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt></a> on port <tt class="docutils literal"><span class="pre">27017</span></tt>
of <tt class="docutils literal"><span class="pre">mongodb0.example.net</span></tt>, issue the following command:</p>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">sh</span><span class="p">.</span><span class="nx">addShard</span><span class="p">(</span> <span class="s2">&quot;mongodb0.example.net:27017&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It might take some time for <a class="reference internal" href="../../reference/glossary/#term-chunk"><em class="xref std std-term">chunks</em></a> to
migrate to the new shard.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="enable-sharding-for-a-database">
<span id="sharding-setup-enable-sharding"></span><h2>Enable Sharding for a Database<a class="headerlink" href="#enable-sharding-for-a-database" title="Permalink to this headline">¶</a></h2>
<p>Before you can shard a collection, you must enable sharding for the
collection&#8217;s database. Enabling sharding for a database does not
redistribute data but make it possible to shard the collections in that
database.</p>
<p>Once you enable sharding for a database, MongoDB assigns a
<a class="reference internal" href="../../reference/glossary/#term-primary-shard"><em class="xref std std-term">primary shard</em></a> for that database where MongoDB stores all data
before sharding begins.</p>
<ol class="arabic">
<li><p class="first">From a <a class="reference internal" href="../../reference/mongo/#bin.mongo" title="bin.mongo"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt></a> shell, connect to the <a class="reference internal" href="../../reference/mongos/#bin.mongos" title="bin.mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>
instance. Issue a command using the following syntax:</p>
<div class="highlight-sh"><div class="highlight"><pre>mongo --host &lt;hostname of machine running mongos&gt; --port &lt;port mongos listens on&gt;
</pre></div>
</div>
</li>
<li><p class="first">Issue the <a class="reference internal" href="../../reference/method/sh.enableSharding/#sh.enableSharding" title="sh.enableSharding"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.enableSharding()</span></tt></a> method, specifying the name
of the database for which to enable sharding. Use the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">sh</span><span class="p">.</span><span class="nx">enableSharding</span><span class="p">(</span><span class="s2">&quot;&lt;database&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>Optionally, you can enable sharding for a database using the
<a class="reference internal" href="../../reference/command/enableSharding/#dbcmd.enableSharding" title="dbcmd.enableSharding"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">enableSharding</span></tt></a> command, which uses the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">enableSharding</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">database</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="enable-sharding-for-a-collection">
<span id="sharding-setup-shard-collection"></span><h2>Enable Sharding for a Collection<a class="headerlink" href="#enable-sharding-for-a-collection" title="Permalink to this headline">¶</a></h2>
<p>You enable sharding on a per-collection basis.</p>
<ol class="arabic">
<li><p class="first">Determine what you will use for the <a class="reference internal" href="../../reference/glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a>. Your selection
of the shard key affects the efficiency of sharding. See the
selection considerations listed in the <a class="reference internal" href="../../core/sharded-clusters/#sharding-shard-key-selection"><em>Shard Key Selection</em></a>.</p>
</li>
<li><p class="first">If the collection already contains data you must create an index on
the <a class="reference internal" href="../../reference/glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a> using <a class="reference internal" href="../../reference/method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a>.
If the collection is empty then MongoDB will create the index as part
of the <a class="reference internal" href="../../reference/method/sh.shardCollection/#sh.shardCollection" title="sh.shardCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.shardCollection()</span></tt></a> step.</p>
</li>
<li><p class="first">Enable sharding for a collection by issuing the
<a class="reference internal" href="../../reference/method/sh.shardCollection/#sh.shardCollection" title="sh.shardCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.shardCollection()</span></tt></a> method in the <a class="reference internal" href="../../reference/mongo/#bin.mongo" title="bin.mongo"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt></a> shell.
The method uses the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">sh</span><span class="p">.</span><span class="nx">shardCollection</span><span class="p">(</span><span class="s2">&quot;&lt;database&gt;.&lt;collection&gt;&quot;</span><span class="p">,</span> <span class="nx">shard</span><span class="o">-</span><span class="nx">key</span><span class="o">-</span><span class="nx">pattern</span><span class="p">)</span>
</pre></div>
</div>
<p>Replace the <tt class="docutils literal"><span class="pre">&lt;database&gt;.&lt;collection&gt;</span></tt> string with the full
namespace of your database, which consists of the name of your
database, a dot (e.g. <tt class="docutils literal"><span class="pre">.</span></tt>), and the full name of the collection.
The <tt class="docutils literal"><span class="pre">shard-key-pattern</span></tt> represents your shard key, which you
specify in the same form as you would an <a class="reference internal" href="../../reference/method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">index</span></tt></a> key pattern.</p>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<p>The following sequence of commands shards four collections:</p>
<div class="last highlight-javascript"><div class="highlight"><pre><span class="nx">sh</span><span class="p">.</span><span class="nx">shardCollection</span><span class="p">(</span><span class="s2">&quot;records.people&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;zipcode&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
<span class="nx">sh</span><span class="p">.</span><span class="nx">shardCollection</span><span class="p">(</span><span class="s2">&quot;people.addresses&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;state&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
<span class="nx">sh</span><span class="p">.</span><span class="nx">shardCollection</span><span class="p">(</span><span class="s2">&quot;assets.chairs&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">alerts</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">(</span> <span class="p">{</span> <span class="nx">_id</span> <span class="o">:</span> <span class="s2">&quot;hashed&quot;</span> <span class="p">}</span> <span class="p">)</span>
<span class="nx">sh</span><span class="p">.</span><span class="nx">shardCollection</span><span class="p">(</span><span class="s2">&quot;events.alerts&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;hashed&quot;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<p>In order, these operations shard:</p>
<ol class="arabic">
<li><p class="first">The <tt class="docutils literal"><span class="pre">people</span></tt> collection in the <tt class="docutils literal"><span class="pre">records</span></tt> database using the
shard key <tt class="docutils literal"><span class="pre">{</span> <span class="pre">&quot;zipcode&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;name&quot;:</span> <span class="pre">1</span> <span class="pre">}</span></tt>.</p>
<p>This shard key distributes documents by the value of the
<tt class="docutils literal"><span class="pre">zipcode</span></tt> field. If a number of documents have the same value
for this field, then that <a class="reference internal" href="../../reference/glossary/#term-chunk"><em class="xref std std-term">chunk</em></a> will be <a class="reference internal" href="../../core/sharded-cluster-internals/#sharding-shard-key-cardinality"><em>splitable</em></a> by the values of the <tt class="docutils literal"><span class="pre">name</span></tt>
field.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">addresses</span></tt> collection in the <tt class="docutils literal"><span class="pre">people</span></tt> database using the
shard key <tt class="docutils literal"><span class="pre">{</span> <span class="pre">&quot;state&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;_id&quot;:</span> <span class="pre">1</span> <span class="pre">}</span></tt>.</p>
<p>This shard key distributes documents by the value of the <tt class="docutils literal"><span class="pre">state</span></tt>
field. If a number of documents have the same value for this
field, then that <a class="reference internal" href="../../reference/glossary/#term-chunk"><em class="xref std std-term">chunk</em></a> will be <a class="reference internal" href="../../core/sharded-cluster-internals/#sharding-shard-key-cardinality"><em>splitable</em></a> by the values of the <tt class="docutils literal"><span class="pre">_id</span></tt>
field.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">chairs</span></tt> collection in the <tt class="docutils literal"><span class="pre">assets</span></tt> database using the shard key
<tt class="docutils literal"><span class="pre">{</span> <span class="pre">&quot;type&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;_id&quot;:</span> <span class="pre">1</span> <span class="pre">}</span></tt>.</p>
<p>This shard key distributes documents by the value of the <tt class="docutils literal"><span class="pre">type</span></tt>
field. If a number of documents have the same value for this
field, then that <a class="reference internal" href="../../reference/glossary/#term-chunk"><em class="xref std std-term">chunk</em></a> will be <a class="reference internal" href="../../core/sharded-cluster-internals/#sharding-shard-key-cardinality"><em>splitable</em></a> by the values of the <tt class="docutils literal"><span class="pre">_id</span></tt>
field.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">alerts</span></tt> collection in the <tt class="docutils literal"><span class="pre">events</span></tt> database using the shard key
<tt class="docutils literal"><span class="pre">{</span> <span class="pre">&quot;_id&quot;:</span> <span class="pre">&quot;hashed&quot;</span> <span class="pre">}</span></tt>.</p>
<p class="versionadded">
<span class="versionmodified">New in version 2.4.</span></p>
<p>This shard key distributes documents by a hash of the value of
the <tt class="docutils literal"><span class="pre">_id</span></tt> field.  MongoDB computes the hash of the <tt class="docutils literal"><span class="pre">_id</span></tt>
field for the <a class="reference internal" href="../../administration/indexes/#index-hashed-index"><em>hashed index</em></a>,
which should provide an even distribution of documents across a
cluster.</p>
</li>
</ol>
</li>
</ol>
</div>
</div>


<div id="btnv">
<ul id="btnvl">
<li id="btnvpr"><a href="../../core/sharded-cluster-internals/" title="Previous Section: Sharded Cluster Internals and Behaviors">&lt; &nbsp; Sharded Cluster Internals and Behaviors</a></li>
<li id="btnvup"><a href="../../sharding/" title="Parent Section: Sharding" >&#47;&#92;&nbsp; Sharding</a></li>
<li id="btnvnx"><a href="../add-shards-to-shard-cluster/" title="Next Section: Add Shards to a Cluster">Add Shards to a Cluster &nbsp;&gt;</a></li>
</ul>
</div>
</div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><h3><a href="../../contents/">MongoDB Manual</a>

<small><a href="../../genindex/">(Index)</a></small>
</h3>


<h4 id="vnd">Version: <span id="vn">2.4</span></h4>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/">Installing MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crud/">Core MongoDB Operations (CRUD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aggregation/">Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications/text-search/">Text Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indexes/">Indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../replication/">Replication</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../sharding/">Sharding</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../sharding/#sharded-cluster-use-and-operation">Sharded Cluster Use and Operation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../sharding/#sharded-cluster-tutorials-and-procedures">Sharded Cluster Tutorials and Procedures</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../sharding/#getting-started-with-sharded-clusters">Getting Started With Sharded Clusters</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="">Deploy a Sharded Cluster</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#start-the-config-server-database-instances">Start the Config Server Database Instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="#start-the-mongos-instances">Start the <tt class="docutils literal"><span class="pre">mongos</span></tt> Instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="#add-shards-to-the-cluster">Add Shards to the Cluster</a></li>
<li class="toctree-l5"><a class="reference internal" href="#enable-sharding-for-a-database">Enable Sharding for a Database</a></li>
<li class="toctree-l5"><a class="reference internal" href="#enable-sharding-for-a-collection">Enable Sharding for a Collection</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../add-shards-to-shard-cluster/">Add Shards to a Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../view-sharded-cluster-configuration/">View Cluster Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../sharding/#sharded-cluster-maintenance-and-administration">Sharded Cluster Maintenance and Administration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sharding/#backup-and-restore-sharded-clusters">Backup and Restore Sharded Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sharding/#application-development-patterns-for-sharded-clusters">Application Development Patterns for Sharded Clusters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../sharding/#sharded-cluster-reference">Sharded Cluster Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../applications/">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mongo/">Using the <tt class="docutils literal"><span class="pre">mongo</span></tt> Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../use-cases/">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../">MongoDB Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/">About MongoDB Documentation</a></li>
</ul>

<h3 style="padding-bottom: 1em;"><a href="http://www.mongodb.org/about/">MongoDB.org</a></h3>
<h3 style="padding-bottom: 1em;"><a href="http://docs.mongodb.org/ecosystem/">MongoDB Ecosystem</a></h3><h3>Formats</h3>
<ul class="this-page-menu">
  <li><a href="/manual/single/">MongoDB Manual, Single HTML Page</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.pdf" rel="nofollow">MongoDB Manual, PDF Format</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.epub" rel="nofollow">MongoDB Manual, ePub Format</a></li>
</ul><h3>MongoDB Resources</h3>

<ul>
 <li><strong>Getting Started</strong>
   <ul>
     <li><a href="http://www.mongodb.org/about/introduction">Introduction</a></li>
     <li><a href="http://www.mongodb.org/downloads">Downloads</a></li>
   </ul>
 </li>
 <li><strong><a href="http://www.mongodb.org/about/community">Community</a> and <a href="http://docs.mongodb.org/ecosystem/">Ecosystem</a></strong>
   <ul>
     <li><a href="http://www.10gen.com">10gen</a></li>
     <li><a href="http://www.10gen.com/events">MongoDB Events</a></li>
     <li><a href="http://planet.mongodb.org">Planet MongoDB</a></li>
     <li><a href="http://mongodb.org/about/community/masters">MongoDB Masters</a></li>
     <li><a href="http://www.10gen.com/presentations">Slides and Video</a></li>
     <li><a href="http://docs.mongodb.org/ecosystem/platforms/">Hosting Center</a></li>
     <li><a href="http://docs.mongodb.org/ecosystem/platforms/windows">Windows</a></li>
     <li><a href="http://www.10gen.com/products/mms/">MongoDB Monitoring Service</a> (<a href="http://mms.10gen.com/help/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/tools/administration-interfaces/">Administrative Interfaces</a></li>
     <li><a href="http://www.10gen.com/books/">MongoDB Books</a></li>
   </ul>
 </li>
 <li><strong><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></strong>
   <ul>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/javascript">JavaScript</a> (<a href="http://api.mongodb.org/js/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/python">Python</a> (<a href="http://api.mongodb.org/python/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/ruby">Ruby</a> (<a href="http://api.mongodb.org/ruby/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/php">PHP</a> (<a href="http://php.net/mongo/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/perl">Perl</a> (<a href="http://api.mongodb.org/perl/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/java">Java</a> (<a href="http://api.mongodb.org/java/current">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/scala">Scala</a> (<a href="http://api.mongodb.org/scala/casbah/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/csharp">C#</a> (<a href="http://api.mongodb.org/csharp/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/c">C</a> (<a href="http://api.mongodb.org/c/current/">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/cpp">C++</a> (<a href="http://api.mongodb.org/cplusplus/current/">docs</a>)</li>
     <li><a href="http://hackage.haskell.org/package/mongoDB">Haskell</a> (<a href="http://api.mongodb.org/haskell">docs</a>)</li>
     <li><a href="http://docs.mongodb.org/ecosystem/drivers/erlang">Erlang</a> (<a href="http://api.mongodb.org/erlang">docs</a>)</li>
   </ul>
 </li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    <p>
       &copy; <a href="">Copyright</a> 2011-2013, 10gen, Inc. 
       MongoDB&reg;, Mongo&reg;, and the leaf logo are registered trademarks of 10gen, Inc.
    </p>
  </div><script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
_gaq.push(['_setAccount', 'UA-7301842-8']);
_gaq.push(['_setDomainName', 'docs.mongodb.org']);
_gaq.push(['_trackPageview']);
(function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
        })();
</script>

<script type="text/javascript">
document.write(unescape("%3Cscript src='" + document.location.protocol + "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>try { mktoMunchkin("017-HGS-593"); } catch(e) {}</script><script type="text/javascript">
jQuery.ajax({
	 url: "https://jira.mongodb.org/s/en_UScn8g8x/782/6/1.2.5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId=298ba4e7",
	 type: "get",
	 cache: true,
	 dataType: "script"
	});
window.ATL_JQ_PAGE_PROPS =  {
	"triggerFunction": function(showCollectorDialog) {
		jQuery("#jirafeedback").click(function(e) {e.preventDefault();showCollectorDialog();});},
		fieldValues: {component: 'mongodb-manual', summary: 'Comment on: "manual/tutorial/deploy-shard-cluster.txt"'},
		environment: {'repo': 'docs','source': 'tutorial/deploy-shard-cluster'}
		};
</script><script type="text/javascript">
var versions = [{'t': '2.4 (current)', 'v': 'v2.4'}, {'t': '2.2', 'v': 'v2.2'}]
var pagename = 'tutorial/deploy-shard-cluster'
var stable = 'v2.4'

function vfnav() {
    if ( pagename=='index' ) {
        pn = ''
    }
    else {
        pn = pagename
    }

    v = $(this).children("option:selected").attr('value')

    if ( (v==0) || (v==stable) ) {
        uri = '/manual/' + pn
    }
    else {
        uri = '/' + v + '/' + pn
    }
    window.location.href= uri;
}

$(document).ready(function(){
    $("#vn").html(function(){
        s=$("<select/>");
        o='<option/>';

        $.each(versions,function(index, version) {
            if ( version.v==stable ) {
                dv=true;
            }
            $(o,{value:version.v,text: version.t}).appendTo(s);
        });

        if ( dv==false ) {
            $(o, {value:0,text:'(stable)'}).appendTo(s);
        }
        return(s);
    });

    $("#vn select").bind('change', vfnav);
    $('#vn select').val('v2.4');
});
</script>
</body>
</html>